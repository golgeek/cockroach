load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "templates",
    srcs = [
        "backend.go",
        "backend_gcs.go",
        "backend_interface.go",
        "backend_local.go",
        "files.go",
        "manager.go",
        "parser.go",
        "snapshot.go",
        "validate.go",
    ],
    importpath = "github.com/cockroachdb/cockroach/pkg/cmd/roachprod-centralized/services/provisionings/templates",
    visibility = ["//visibility:public"],
    deps = [
        "//pkg/cmd/roachprod-centralized/models/provisionings",
        "//pkg/cmd/roachprod-centralized/utils/logger",
        "//pkg/util/yamlutil",
        "@com_github_cockroachdb_errors//:errors",
        "@com_github_hashicorp_hcl_v2//:hcl",
        "@com_github_hashicorp_hcl_v2//ext/typeexpr",
        "@com_github_hashicorp_hcl_v2//hclparse",
        "@com_github_zclconf_go_cty//cty",
        "@com_github_zclconf_go_cty//cty/convert",
        "@com_github_zclconf_go_cty//cty/json",
        "@com_google_cloud_go_storage//:storage",
        "@org_golang_google_api//iterator",
    ],
)

go_test(
    name = "templates_test",
    srcs = [
        "backend_test.go",
        "manager_test.go",
        "parser_test.go",
        "validate_test.go",
    ],
    embed = [":templates"],
    deps = [
        "//pkg/cmd/roachprod-centralized/models/provisionings",
        "//pkg/cmd/roachprod-centralized/utils/logger",
        "//pkg/testutils/skip",
        "@com_github_cockroachdb_errors//oserror",
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//require",
    ],
)
